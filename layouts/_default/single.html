{{ define "main" }}
{{ if eq .Section "posts" }}
<article class="post" data-pagefind-body>
    {{ else }}
    <article class="post" data-pagefind-ignore="all">
        {{ end }}
        <a href="/" class="back-link" data-pagefind-ignore>← Back to home</a>

        <header class="post-header">
            <h1 class="post-title">{{ .Title }}</h1>
            <div class="post-meta" data-pagefind-ignore>
                <time datetime="{{ .Date.Format " 2006-01-02" }}">{{ .Date.Format "January 2, 2006" }}</time>
                <span class="separator">•</span>
                <span>{{ .ReadingTime }} min read</span>
                <span class="separator">•</span>
                <span class="view-count" data-goatcounter-path="{{ .RelPermalink }}">— views</span>
            </div>
            {{ with .Params.tags }}
            <div class="post-card-tags" style="margin-top: var(--spacing-md);" data-pagefind-meta="tags">
                {{ range . }}
                <a href="/tags/{{ . | urlize }}/" class="tag" data-pagefind-filter="tag">{{ . }}</a>
                {{ end }}
            </div>
            {{ end }}
        </header>

        {{/* Table of Contents */}}
        {{ if .TableOfContents }}
        <details class="toc" open>
            <summary class="toc-title">
                <span>Table of Contents</span>
                <svg class="toc-chevron" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </summary>
            <nav class="toc-content" aria-label="Table of Contents">
                {{ .TableOfContents }}
            </nav>
        </details>
        {{ end }}

        <div class="post-content">
            {{ .Content }}
        </div>

        {{/* Comments */}}
        {{ partial "giscus.html" . }}
    </article>
    {{ end }}
